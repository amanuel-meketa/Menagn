<div class="hub-shell">
  <!-- HEADER -->
  <div class="hub-header">
    <div class="hub-title">
      <h1>Template Hub</h1>
      <p class="subtitle">
        Discover, preview, and install approval templates â€” curated & ready to use.
      </p>
    </div>

    <div class="hub-controls">
      <input
        nz-input
        placeholder="Search templates, e.g. leave, loan, admission..."
        [(ngModel)]="search"
        (ngModelChange)="applyFilters()"
        aria-label="Search templates"
        class="search-input" />

      <nz-select
        [(ngModel)]="category"
        (ngModelChange)="applyFilters()"
        style="width: 180px;"
        aria-label="Filter by category">
        <nz-option *ngFor="let c of categories" [nzLabel]="c" [nzValue]="c"></nz-option>
      </nz-select>

      <button nz-button nzType="default" (click)="load()">
        <i nz-icon nzType="reload"></i>&nbsp;Refresh
      </button>
    </div>
  </div>

  <!-- FEATURED TEMPLATES -->
  <div class="featured-row" *ngIf="featuredTemplates?.length">
    <nz-badge *ngFor="let t of featuredTemplates" nzDot>
      <div class="featured-item" (click)="openPreview(t)">
        <nz-avatar nzSize="large" [nzText]="t.name?.charAt(0)"></nz-avatar>
        <div class="featured-meta">
          <div class="f-name">{{ t.name }}</div>
          <div class="f-desc">{{ t.description }}</div>
        </div>
      </div>
    </nz-badge>
  </div>

  <!-- SKELETON WHILE LOADING -->
  <nz-skeleton *ngIf="loading" [nzActive]="true" [nzParagraph]="{ rows: 4 }"></nz-skeleton>

  <!-- EMPTY STATE -->
  <nz-empty *ngIf="!loading && filtered.length === 0" nzNotFoundContent="No templates found"></nz-empty>

  <!-- TEMPLATE GRID -->
  <div class="grid" *ngIf="!loading && filtered.length > 0">
    <div class="grid-row">
      <nz-card
        *ngFor="let t of pageData()"
        class="template-card"
        [ngClass]="{ featured: t.featured }"
        [nzBordered]="false"
      >
        <!-- CARD COVER -->
        <div class="card-cover" [ngStyle]="{'background-color': t.featured ? '#f0f5ff' : '#fafafa'}">
          <div class="cover-placeholder">
            <i nz-icon nzType="file"></i>
          </div>
        </div>

        <!-- CARD META -->
        <div class="card-meta">
          <div class="meta-top">
            <h3 class="meta-title">{{ t.name }}</h3>

            <div class="meta-actions">
              <button nz-button nzType="link" nzSize="small" (click)="openPreview(t)" nz-tooltip nzTooltipTitle="Preview">
                <i nz-icon nzType="eye"></i>
              </button>
              <button nz-button nzType="primary" nzSize="small" (click)="download(t)" nz-tooltip nzTooltipTitle="Download">
                <i nz-icon nzType="download"></i>
              </button>
            </div>
          </div>

          <p class="meta-desc" nz-tooltip [nzTooltipTitle]="t.description">
            {{ t.description }}
          </p>

          <div class="meta-footer">
            <div class="left">
              <nz-tag *ngIf="t.category" [nzColor]="t.featured ? 'purple' : 'blue'">{{ t.category }}</nz-tag>
              <span class="stages">{{ t.stages }} stage{{ t.stages > 1 ? 's' : '' }}</span>
            </div>

            <div class="right">
              <nz-avatar *ngIf="t.author" nzSize="small" [nzText]="t.author.charAt(0)"></nz-avatar>
              <small *ngIf="t.version" class="version">v{{ t.version }}</small>
            </div>
          </div>
        </div>
      </nz-card>
    </div>

    <!-- PAGINATION -->
    <nz-pagination
      [nzTotal]="filtered.length"
      [nzPageSize]="pageSize"
      [(nzPageIndex)]="pageIndex"
      (nzPageIndexChange)="pageIndex = $event"
      [nzShowSizeChanger]="true"
      [nzPageSizeOptions]="[8,16,24]"
      class="pager">
    </nz-pagination>
  </div>

  <!-- PREVIEW MODAL -->
  <ng-template #previewTpl>
    <div class="preview-body">
      <h2>{{ previewTemplate?.name }}</h2>
      <p>{{ previewTemplate?.description }}</p>

      <div class="preview-stages" *ngIf="previewTemplate?.stages">
        <h4>Stages</h4>
        <p>{{ previewTemplate?.stages ?? 0 }} stage{{ (previewTemplate?.stages ?? 0) > 1 ? 's' : '' }}</p>
      </div>

      <div class="preview-actions">
        <button nz-button nzType="primary" (click)="download(previewTemplate!)">
          <i nz-icon nzType="download"></i>&nbsp;Download
        </button>
      </div>
    </div>
  </ng-template>
</div>
