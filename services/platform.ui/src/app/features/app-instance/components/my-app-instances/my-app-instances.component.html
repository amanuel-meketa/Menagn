<!-- HEADER -->
<header class="instance-header">
  <div class="header-left">
    <h2 class="page-title">My Application Instances</h2>
    <p class="page-sub">Overview of instances you submitted.</p>
  </div>
</header>

<!-- FILTER BAR -->
<section class="instance-filter-bar">
  <div class="filter-row">

    <label class="filter-item">
      <i nz-icon nzType="search" class="filter-icon"></i>
      <input
        nz-input
        placeholder="Search template name or id"
        [(ngModel)]="templateFilter"
        (ngModelChange)="onFilterChange()"
      />
    </label>

    <label class="filter-item no-grow">
      <i nz-icon nzType="calendar" class="filter-icon"></i>
      <nz-range-picker
        [(ngModel)]="dateRange"
        (ngModelChange)="onFilterChange()">
      </nz-range-picker>
    </label>

    <label class="filter-item no-grow">
      <i nz-icon nzType="tag" class="filter-icon"></i>
      <nz-select
        [(ngModel)]="statusFilter"
        (ngModelChange)="onFilterChange()"
        nzAllowClear
        nzPlaceHolder="Status">

        <nz-option nzValue="Pending" nzLabel="Pending"></nz-option>
        <nz-option nzValue="Approved" nzLabel="Approved"></nz-option>
        <nz-option nzValue="Rejected" nzLabel="Rejected"></nz-option>

      </nz-select>
    </label>

    <button nz-button (click)="clearFilters()">Clear</button>
  </div>
</section>

<!-- LIST -->
<main class="instance-list">
  <ng-container *ngIf="pagedList.length; else empty">

 <nz-card
  *ngFor="let instance of pagedList"
  class="instance-card"
  [nzBodyStyle]="{ padding: '16px 20px', display: 'flex', flexDirection: 'column', gap: '12px' }">

  <!-- META -->
  <div class="meta-main">
    <div class="meta-header" style="display:flex; justify-content:space-between; align-items:center;">
      <div>
        <a class="instance-link">
          {{ instance.template.name || instance.template.templateId || 'â€”' }}
        </a>
        <div class="meta-sub">
          Created: {{ instance.createdAt | date:'mediumDate' }}
        </div>
      </div>
    </div>

    <!-- STATS -->
    <div class="meta-stats" style="display:flex; align-items:center; ">
      <div>Stage: {{ instance.currentStageOrder }} / {{ instance.allStages || '-' }}</div>
     
      <nz-tag [nzColor]="getStatusColor(instance.overallStatus)">
        {{ instance.overallStatus }}
      </nz-tag>
    </div>
  </div>

  <!-- PROGRESS -->
  <div class="progress-wrapper">
    <app-stage-progress
      [templateId]="instance.template.templateId"
      [currentStageOrder]="instance.currentStageOrder">
    </app-stage-progress>
  </div>


</nz-card>

  </ng-container>

  <ng-template #empty>
    <p class="empty">No instances found</p>
  </ng-template>
</main>

<!-- PAGINATION -->
<nz-pagination
  *ngIf="filteredList.length"
  [nzTotal]="filteredList.length"
  [nzPageIndex]="pageIndex"
  [nzPageSize]="pageSize"
  [nzPageSizeOptions]="pageSizeOptions"
  [nzShowSizeChanger]="true"
  (nzPageIndexChange)="onPageIndexChange($event)"
  (nzPageSizeChange)="onPageSizeChange($event)">
</nz-pagination>
