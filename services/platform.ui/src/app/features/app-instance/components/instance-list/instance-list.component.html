<!-- SUMMARY AND FILTERS -->
<div nz-row [nzGutter]="16">

  <!-- SUMMARY -->
  <div nz-col nzSpan="24">
    <nz-card class="summary-card summary-header" nzBordered>
      <nz-space nzSize="large" nzAlign="center">
        <div class="stat">
          <div class="stat-label">Total</div>
          <div class="stat-value">{{ instances.length }}</div>
        </div>
        <div class="stat">
          <div class="stat-label">Pending</div>
          <div class="stat-value warning">{{ countByStatus('Pending') }}</div>
        </div>
        <div class="stat">
          <div class="stat-label">Approved</div>
          <div class="stat-value success">{{ countByStatus('Approved') }}</div>
        </div>
        <div class="stat">
          <div class="stat-label">Rejected</div>
          <div class="stat-value danger">{{ countByStatus('Rejected') }}</div>
        </div>
      </nz-space>
    </nz-card>
  </div>

  <!-- FILTERS -->
  <div nz-col nzSpan="24">
    <nz-card nzBordered class="filter-card">
      <nz-space nzSize="middle" nzWrap>
        <strong class="section-title">Approval Instances</strong>

        <!-- TEMPLATE FILTER -->
        <nz-select
          nzShowSearch
          nzAllowClear
          [(ngModel)]="selectedValue"
          nzPlaceHolder="Template"
          class="filter-select">
          <nz-option
            *ngFor="let tmpl of templates"
            [nzLabel]="tmpl.label"
            [nzValue]="tmpl.value">
          </nz-option>
        </nz-select>

        <!-- STATUS FILTER -->
        <nz-select
          nzAllowClear
          [(ngModel)]="statusFilter"
          nzPlaceHolder="Status"
          class="filter-select">
          <nz-option nzLabel="Pending" nzValue="Pending"></nz-option>
          <nz-option nzLabel="Approved" nzValue="Approved"></nz-option>
          <nz-option nzLabel="Rejected" nzValue="Rejected"></nz-option>
        </nz-select>

        <button nz-button nzType="default" (click)="clearFilter()">
          Reset
        </button>
      </nz-space>
    </nz-card>
  </div>

</div>

<!-- RESPONSIVE NG-ZORRO TABLE -->
<nz-table
  #instanceTable
  [nzData]="filteredInstances()"
  [nzFrontPagination]="true"
  [nzPageSize]="10"
  nzBordered
  nzSize="middle"
  [nzScroll]="{ x: '1000px' }">

  <thead>
    <tr>
      <th nzWidth="40px"></th>
      <th>Template</th>
      <th>Created By</th>
      <th>Status</th>
      <th>Created At</th>
      <th>Stage</th>
      <th>Progress</th>
      <th>Action</th>
    </tr>
  </thead>

  <tbody>
    <tr *ngFor="let inst of instanceTable.data">
      <td>
        <nz-avatar nzIcon="file-text" style="background-color:#1677ff"></nz-avatar>
      </td>
      <td>{{ inst.template.name }}</td>
      <td>{{ inst.createdBy.fullName || '-' }}</td>
      <td>
        <nz-tag [nzColor]="getStatusColor(inst.overallStatus)">
          {{ inst.overallStatus }}
        </nz-tag>
      </td>
      <td>{{ inst.createdAt | date:'mediumDate' }}</td>
      <td>{{ inst.currentStageOrder }} / {{ inst.allStages || '-' }}</td>
      <td>
        <nz-progress
          [nzPercent]="getProgressPercent(inst)"
          nzType="circle"
          [nzWidth]="40"
          [nzStatus]="inst.overallStatus === 'Rejected' ? 'exception' : 'normal'">
        </nz-progress>
      </td>
      <td>
        <button nz-button nzType="link" (click)="onViewDetails(inst)">View</button>
      </td>
    </tr>
  </tbody>
</nz-table>
