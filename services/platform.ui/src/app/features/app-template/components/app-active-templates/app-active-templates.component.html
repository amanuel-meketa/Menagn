<!-- HEADER -->
<header class="instance-header">
  <div class="header-left">
    <h2 class="page-title">Active Templates</h2>
    <p class="page-sub">Browse available templates and start a new request.</p>
  </div>
</header>

<!-- FILTER BAR -->
<section class="instance-filter-bar">
  <div class="filter-row">
    <label class="filter-item">
      <i nz-icon nzType="search" class="filter-icon"></i>
      <input nz-input placeholder="Search templates..." [(ngModel)]="searchQuery" />
    </label>
  </div>
</section>

<!-- LIST -->
<main class="instance-list">
  <ng-container *ngIf="!isLoading; else loading">
    <ng-container *ngIf="displayedTemplates().length; else empty">
      <nz-card *ngFor="let template of displayedTemplates()" class="instance-card" nzHoverable>
        <div class="meta-main">
          <div class="meta-header">
            <div>
              <a class="instance-link" [nz-tooltip]="template.description && template.description.length>200 ? template.description : null">{{ template.name }}</a>
            </div>
          </div>

          <div class="meta-sub" [class.clamped]="!template.showFullDescription && (template.description.length>200)">
            <ng-container *ngIf="template.description; else noDesc">
              <span *ngIf="!template.showFullDescription">{{ template.description }}</span>
              <span *ngIf="template.showFullDescription">{{ template.description }}</span>
              <a class="read-toggle" *ngIf="template.description.length>200" (click)="template.showFullDescription = !template.showFullDescription">
                {{ template.showFullDescription ? 'Show Less' : 'Read More' }}
              </a>
            </ng-container>
            <ng-template #noDesc></ng-template>
          </div>

          <div class="card-action">
            <button nz-button nzType="primary" (click)="startApp(template)">Start Request</button>
          </div>
        </div>
      </nz-card>
    </ng-container>
  </ng-container>

  <ng-template #empty>
    <div class="empty-state">
      <nz-empty nzNotFoundImage="default"></nz-empty>
      <p>No templates found</p>
    </div>
  </ng-template>

  <ng-template #loading>
    <div class="skeleton-grid">
      <ng-container *ngFor="let i of [1,2,3]">
        <nz-skeleton [nzActive]="true" [nzTitle]="true" [nzParagraph]="true" [nzAvatar]="false"></nz-skeleton>
      </ng-container>
    </div>
  </ng-template>

  </main>

  <footer class="instance-footer" *ngIf="!isLoading && filteredTemplates().length">
    <nz-pagination [nzPageIndex]="pageIndex" [nzPageSize]="pageSize" [nzTotal]="filteredTemplates().length" (nzPageIndexChange)="onPageChange($event)" [nzPageSizeOptions]="pageSizeOptions"></nz-pagination>
  </footer>
